{% extends "base.html" %}

{% block content %}

<div class="edit-game-container">
    <div class="game-header">
        <div class="game-title">Edit Game</div>
        <div class="game-date">{{ game.start_date.strftime('%B %d, %Y') }}</div>
    </div>
    
    <div class="scorecard-link">
        <a href="{{ url_for('view_scorecard', game_token=game.token) }}" class="scorecard-button">View Live Scorecard</a>
    </div>

    <div class="form-container">
        <div class="section-title">Current Players</div>
        
        <div class="players-list">
            {% for player in players %}
            <div class="player-card">
                <div class="player-info">
                    <div class="player-name">{{ player.user.name if player.user else player.non_registered_player.name }}</div>
                    <div class="player-team">{{ player.team.name }}</div>
                    <div class="player-score">Score: {{ player.score if player.score else 0 }}</div>
                </div>
                <div class="player-actions">
                    <form method="post" action="{{ url_for('delete_player', game_id=game.id, player_id=player.id) }}" class="delete-form">
                        <button type="submit" class="delete-button">Remove</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="section-title">Add New Player</div>
        <form method="post" action="{{ url_for('add_player', game_id=game.id) }}" class="add-player-form">
            <div class="input-container">
                <label for="player_name">Player Name</label>
                <input type="text" name="player_name" id="player_name" required>
            </div>
            <div class="input-container">
                <label for="team_id">Team</label>
                <select name="team_id" id="team_id" required>
                    <option value="">Select a team</option>
                    {% for team in teams %}
                    <option value="{{ team.id }}">{{ team.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="add-player-button">Add Player</button>
        </form>

        <div class="danger-zone">
            <div class="section-title danger-title">Danger Zone</div>
            <button type="button" class="delete-game-button delete-game-btn" data-game-id="{{ game.id }}" data-game-name="{{ game.start_date.strftime('%B %d, %Y') if game.start_date else 'Game' }}">
                Delete Game
            </button>
        </div>
    </div>
</div>

<!-- Delete Game Confirmation Modal -->
<div class="modal fade" id="deleteGameModal" tabindex="-1" role="dialog" aria-labelledby="deleteGameModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteGameModalLabel">
                    <i class="fas fa-exclamation-triangle mr-2"></i>Delete Game
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="mb-2">Are you sure you want to delete this game?</p>
                <p class="text-muted mb-0">This action cannot be undone.</p>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times mr-2"></i>Cancel
                </button>
                <form id="deleteGameForm" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash mr-2"></i>Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Delete Confirmation -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle delete game button clicks
    document.querySelectorAll('.delete-game-btn').forEach(button => {
        button.addEventListener('click', function() {
            const gameId = this.getAttribute('data-game-id');
            const gameName = this.getAttribute('data-game-name');
            
            // Update modal content
            document.getElementById('deleteGameModalLabel').innerHTML = 
                '<i class="fas fa-exclamation-triangle mr-2"></i>Delete ' + gameName;
            
            // Update form action
            document.getElementById('deleteGameForm').action = '/game/' + gameId + '/delete';
            
            // Show modal
            $('#deleteGameModal').modal('show');
        });
    });
});
</script>

{% endblock %}
