{% extends "base.html" %}

{% block content %}

<div class="scorecard-container">
    <div class="scorecard-header">
        <div class="scorecard-title">{{ game.pool_name }} MLB Pool</div>
        <div class="game-date">This pool is for regular season games on and after {{ game.start_date.strftime('%B %d, %Y') }}</div>
    </div>

    <div class="scorecard-table-container">
        <table class="scorecard-table">
            <thead>
                <tr>
                    <th class="name-header">Member</th>
                    <th class="team-header">Team</th>
                    <th class="gp-header">GP</th>
                    <th class="runs-header" colspan="14">Runs</th>
                    <th class="matches-header">Matches</th>
                </tr>
            </thead>
            <tbody>
                {% if players %}
                    {% for player in players %}
                    <tr class="player-row">
                        <td class="player-name">
                            {% if player.user %}
                                {{ player.user.name }}
                            {% elif player.non_registered_player %}
                                {{ player.non_registered_player.name }}
                            {% endif %}
                        </td>
                        <td class="team-name">{{ player.team.name if player.team else 'N/A' }}</td>
                        <td class="games-played">
                            {% if player.team %}
                                {{ player.team.games_played(game.id) }}
                            {% else %}
                                0
                            {% endif %}
                        </td>
                        {% for run_total in range(14) %}
                        <td class="run-total-cell {% if player.team and player.team.id in team_run_totals and run_total in team_run_totals[player.team.id] %}match-cell{% else %}no-match-cell{% endif %}">
                            <span class="run-number">{{ run_total }}</span>
                        </td>
                        {% endfor %}
                        <td class="matches-count">
                            {% if player.team and player.team.id in team_run_totals %}
                                {{ team_run_totals[player.team.id]|length }}
                            {% else %}
                                0
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr class="no-players">
                        <td colspan="17" class="no-players-message">No players have joined this pool yet.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <div class="scorecard-actions">
        {% if current_user.is_authenticated %}
            <a href="{{ url_for('view_game', game_id=game.id) }}" class="action-button edit-button">
                <i class="fas fa-edit"></i>
                <span>Edit your game</span>
            </a>
            <a href="#" class="action-button share-button" onclick="shareGame()">
                <i class="fas fa-share-alt"></i>
                <span>Share game Link</span>
            </a>
            <a href="#" class="action-button print-button" onclick="window.print()">
                <i class="fas fa-print"></i>
                <span>Print your scoresheet</span>
            </a>
            <a href="{{ url_for('create_game') }}" class="action-button new-pool-button">
                <i class="fas fa-th"></i>
                <span>Start a new pool</span>
            </a>
            <a href="#" class="action-button delete-button" onclick="deleteGame()">
                <i class="fas fa-trash"></i>
                <span>Delete game</span>
            </a>
        {% else %}
            <div class="guest-message">
                <p>Please <a href="{{ url_for('login') }}">login</a> to access game actions.</p>
            </div>
        {% endif %}
    </div>
</div>

<script>
function shareGame() {
    const gameUrl = window.location.href;
    if (navigator.share) {
        navigator.share({
            title: '{{ game.pool_name }} MLB Pool',
            url: gameUrl
        });
    } else {
        // Fallback for browsers that don't support navigator.share
        navigator.clipboard.writeText(gameUrl).then(function() {
            alert('Game link copied to clipboard!');
        });
    }
}

function deleteGame() {
    if (confirm('Are you sure you want to delete this game? This action cannot be undone.')) {
        // You can implement the actual deletion logic here
        alert('Delete functionality would be implemented here.');
    }
}
</script>

{% endblock %}